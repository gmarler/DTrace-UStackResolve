#!/usr/bin/env perl

use strict;
use warnings;
use v5.22;

# VERSION

use DTrace::UStackResolve;
use Getopt::Long;

my ($execname, @pids, $pids_aref, $dtrace_type, $ctor_args);

GetOptions("execname=s", \$execname,
           "pids=s",     \@pids,
           "type=s",     \$dtrace_type,
       )
         or die("Error in command line arguments");

# PODNAME: dtrace_ustack

if (defined($execname)) {
  $ctor_args->{execname} = $execname;
} elsif (scalar(@pids)) {
  $pids_aref = [ split(/,/, join(',',@pids)) ];
  say "PIDS PROVIDED: " . join (',', @$pids_aref);
  $ctor_args->{pids}      = $pids_aref;
}

my $dtus = DTrace::UStackResolve->new(
  $ctor_args
);

my $loop = $dtus->loop;

$loop->run();


